#include <IRremote.h>
#include <IRremoteInt.h> 

// IR LED가 연결된 핀 번호
#define IR_SEND_PIN 11

// IR 발신 객체 생성
IRsend irsend(IR_SEND_PIN);

// 에어컨 모드와 온도에 해당하는 IR 명령어들을 배열로 저장
// 0부터 시작하는 인덱스가 SEND 명령어의 첫 번째 숫자와 매칭된다
// 예: codes[3] = 냉방.약풍, 18도
const unsigned long codes[] = {
  0xC005, // 전원 OFF
  0x30, // 전원 ON 및 냉방. 약풍, 18도
  0x1008, // 파워냉방
  0x830, // 냉방. 약풍, 18도
  0x840, // 냉방. 약풍, 19도
  0x850, // 냉방. 약풍, 20도
  0x860, // 냉방. 약풍, 21도
  0x870, // 냉방. 약풍, 22도
  0x880, // 냉방. 약풍, 23도
  0x890, // 냉방. 약풍, 24도
  0x8A0, // 냉방. 약풍, 25도
  0x8B0, // 냉방. 약풍, 26도
  0x8C0, // 냉방. 약풍, 27도
  0x8D0, // 냉방. 약풍, 28도
  0x8E0, // 냉방. 약풍, 29도
  0x8F0, // 냉방. 약풍, 30도
  0x832, // 냉방. 중풍, 18도
  0x842, // 냉방. 중풍, 19도
  0x852, // 냉방. 중풍, 20도
  0x862, // 냉방. 중풍, 21도
  0x872, // 냉방. 중풍, 22도
  0x882, // 냉방. 중풍, 23도
  0x892, // 냉방. 중풍, 24도
  0x8A2, // 냉방. 중풍, 25도
  0x8B2, // 냉방. 중풍, 26도
  0x8C2, // 냉방. 중풍, 27도
  0x8D2, // 냉방. 중풍, 28도
  0x8E2, // 냉방. 중풍, 29도
  0x8F2, // 냉방. 중풍, 30도
  0x834, // 냉방. 강풍, 18도
  0x844, // 냉방. 강풍, 19도
  0x854, // 냉방. 강풍, 20도
  0x864, // 냉방. 강풍, 21도
  0x874, // 냉방. 강풍, 22도
  0x884, // 냉방. 강풍, 23도
  0x894, // 냉방. 강풍, 24도
  0x8A4, // 냉방. 강풍, 25도
  0x8B4, // 냉방. 강풍, 26도
  0x8C4, // 냉방. 강풍, 27도
  0x8D4, // 냉방. 강풍, 28도
  0x8E4, // 냉방. 강풍, 29도
  0x8F4, // 냉방. 강풍, 30도
  0x835, // 냉방. 자동풍, 18도
  0x845, // 냉방. 자동풍, 19도
  0x855, // 냉방. 자동풍, 20도
  0x865, // 냉방. 자동풍, 21도
  0x875, // 냉방. 자동풍, 22도
  0x885, // 냉방. 자동풍, 23도
  0x895, // 냉방. 자동풍, 24도
  0x8A5, // 냉방. 자동풍, 25도
  0x8B5, // 냉방. 자동풍, 26도
  0x8C5, // 냉방. 자동풍, 27도
  0x8D5, // 냉방. 자동풍, 28도
  0x8E5, // 냉방. 자동풍, 29도
  0x8F5, // 냉방. 자동풍, 30도
  0x930, // 제습. 약풍, 18도
  0x940, // 제습. 약풍, 19도
  0x950, // 제습. 약풍, 20도
  0x960, // 제습. 약풍, 21도
  0x970, // 제습. 약풍, 22도
  0x980, // 제습. 약풍, 23도
  0x990, // 제습. 약풍, 24도
  0x9A0, // 제습. 약풍, 25도
  0x9B0, // 제습. 약풍, 26도
  0x9C0, // 제습. 약풍, 27도
  0x9D0, // 제습. 약풍, 28도
  0x9E0, // 제습. 약풍, 29도
  0x9F0, // 제습. 약풍, 30도
  0x932, // 제습. 중풍, 18도
  0x942, // 제습. 중풍, 19도
  0x952, // 제습. 중풍, 20도
  0x962, // 제습. 중풍, 21도
  0x972, // 제습. 중풍, 22도
  0x982, // 제습. 중풍, 23도
  0x992, // 제습. 중풍, 24도
  0x9A2, // 제습. 중풍, 25도
  0x9B2, // 제습. 중풍, 26도
  0x9C2, // 제습. 중풍, 27도
  0x9D2, // 제습. 중풍, 28도
  0x9E2, // 제습. 중풍, 29도
  0x9F2, // 제습. 중풍, 30도
  0x934, // 제습. 강풍, 18도
  0x944, // 제습. 강풍, 19도
  0x954, // 제습. 강풍, 20도
  0x964, // 제습. 강풍, 21도
  0x974, // 제습. 강풍, 22도
  0x984, // 제습. 강풍, 23도
  0x994, // 제습. 강풍, 24도
  0x9A4, // 제습. 강풍, 25도
  0x9B4, // 제습. 강풍, 26도
  0x9C4, // 제습. 강풍, 27도
  0x9D4, // 제습. 강풍, 28도
  0x9E4, // 제습. 강풍, 29도
  0x9F4, // 제습. 강풍, 30도
  0x935, // 제습. 자동풍, 18도
  0x945, // 제습. 자동풍, 19도
  0x955, // 제습. 자동풍, 20도
  0x965, // 제습. 자동풍, 21도
  0x975, // 제습. 자동풍, 22도
  0x985, // 제습. 자동풍, 23도
  0x995, // 제습. 자동풍, 24도
  0x9A5, // 제습. 자동풍, 25도
  0x9B5, // 제습. 자동풍, 26도
  0x9C5, // 제습. 자동풍, 27도
  0x9D5, // 제습. 자동풍, 28도
  0x9E5, // 제습. 자동풍, 29도
  0x9F5, // 제습. 자동풍, 30도
};

void setup() {
  Serial.begin(9600); 
}

void loop() {
  // 시리얼 포트에 데이터가 들어왔는지 확인
  if (Serial.available()) { 
    // 시리얼 포트에서 한 줄을 읽어 문자열로 저장
    String input = Serial.readStringUntil('\n'); 
    input.trim();

    // 입력이 "SEND"로 시작하는지 확인
    if (input.startsWith("SEND ")) {
      // "SEND " 부분을 제거하여 숫자 부분만 남김
      String data = input.substring(5);
      
      // 쉼표(,) 위치를 찾기
      int commaIndex = data.indexOf(',');
      
      // 쉼표가 존재하는지 확인
      if (commaIndex > 0) {
        // 첫 번째 숫자(인덱스)와 두 번째 숫자(반복 횟수)를 파싱
        String indexStr = data.substring(0, commaIndex);
        String repeatsStr = data.substring(commaIndex + 1);
        
        int index = indexStr.toInt();
        int repeats = repeatsStr.toInt();

        // 인덱스 값이 유효한지 확인 (배열의 범위를 넘지 않는지)
        if (index >= 0 && index < sizeof(codes) / sizeof(codes[0])) {
          // IR 신호 전송
          unsigned long command = codes[index];
          irsend.sendLG(0x88, command, repeats);
          
          // 성공 응답 메시지를 한 줄로 출력
          Serial.print("IR 신호 전송 완료: Command=0x");
          Serial.println(command, HEX);
        } else {
          Serial.println("잘못된 인덱스입니다. 0부터 106 사이의 숫자를 입력하세요.");
        }
      } else {
        Serial.println("잘못된 입력 형식입니다. 'SEND <숫자1>,<숫자2>' 형식으로 입력하세요.");
      }
    } else {
      Serial.println("잘못된 명령어입니다. 'SEND'로 시작하는 명령어를 입력하세요.");
    }
  }
}
